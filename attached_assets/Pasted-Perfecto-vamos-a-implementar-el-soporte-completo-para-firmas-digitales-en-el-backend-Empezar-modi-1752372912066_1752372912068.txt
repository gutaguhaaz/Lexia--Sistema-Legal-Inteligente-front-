Perfecto, vamos a implementar el soporte completo para firmas digitales en el backend. Empezar√© modificando los componentes necesarios:

1. Actualizar el modelo de contrato para soporte de firmas
app/models/contract.py
2. Crear servicio de procesamiento de firmas
app/services/signature_service.py
3. Actualizar el servicio de contratos para soporte de firmas
app/services/contract_service.py
4. Actualizar detecci√≥n de tipos de campo
5. Agregar validaci√≥n en endpoints
app/api/contract_endpoints.py
6. Instalar dependencia para manejo de im√°genes
pip install Pillow
üéØ PROMPT PARA EL FRONTEND ANGULAR
Necesito implementar un componente Angular que maneje campos de firma digitales con soporte para texto, canvas, signature pad e im√°genes PNG.

ESPECIFICACIONES T√âCNICAS
1. Componente Principal: SignatureFieldComponent
Ubicaci√≥n: src/app/components/signature-field/
Selector: <app-signature-field>
Input: fieldConfig (configuraci√≥n del campo)
Output: signatureChange (emite datos de firma)
2. Tipos de Firma Soportados
interface SignatureData {
  type: 'text' | 'canvas' | 'signature-pad' | 'image';
  value: string;
}
interface FieldConfig {
  field: string;
  label: string;
  type: 'signature-text' | 'signature-canvas' | 'signature-image';
  required: boolean;
}
3. Funcionalidades por Tipo
A) Firma Texto (signature-text):

Input normal con placeholder "Escriba su nombre completo"
Validaci√≥n de longitud m√≠nima
B) Firma Canvas (signature-canvas):

Canvas HTML5 para dibujo libre
Controles: Limpiar, Deshacer, Color de trazo
Conversi√≥n autom√°tica a base64 PNG
C) Firma Signature Pad:

Librer√≠a signature_pad para firmas suaves
Responsive y t√°ctil
Calidad de exportaci√≥n configurable
D) Firma Imagen (signature-image):

File input que acepta solo PNG
Preview de imagen seleccionada
Conversi√≥n a base64
4. Interface de Usuario
<div class="signature-field">
  <label>{{ fieldConfig.label }}</label>
  
  <!-- Selector de tipo de firma -->
  <div class="signature-type-selector" *ngIf="showTypeSelector">
    <button [class.active]="selectedType === 'text'" (click)="setType('text')">
      üìù Texto
    </button>
    <button [class.active]="selectedType === 'canvas'" (click)="setType('canvas')">
      ‚úèÔ∏è Dibujar
    </button>
    <button [class.active]="selectedType === 'signature-pad'" (click)="setType('signature-pad')">
      ‚úçÔ∏è Firma
    </button>
    <button [class.active]="selectedType === 'image'" (click)="setType('image')">
      üñºÔ∏è Imagen
    </button>
  </div>
  <!-- √Årea de firma din√°mica -->
  <div class="signature-area">
    <!-- Contenido din√°mico seg√∫n tipo -->
  </div>
  <!-- Preview -->
  <div class="signature-preview" *ngIf="hasSignature">
    <small>Vista previa:</small>
    <!-- Mostrar preview seg√∫n tipo -->
  </div>
</div>
5. Librer√≠as Necesarias
npm install signature_pad
npm install @types/signature_pad
6. Integraci√≥n con API
// En el componente padre (contract-form)
onSubmit() {
  const formData = {
    tipo_contrato: this.selectedTemplate,
    campos: {
      'NOMBRE_CLIENTE': 'Juan P√©rez',
      'FIRMA_EMPLEADO': {
        type: 'canvas',
        value: 'data:image/png;base64,iVBORw0KGgo...'
      },
      'FIRMA_JEFE': {
        type: 'text',
        value: 'Mar√≠a Gonz√°lez Directora'
      }
    }
  };
  
  this.contractService.generateContract(formData).subscribe(/*...*/);
}
üì± EJEMPLO DE USO COMPLETO
// signature-field.component.ts
@Component({
  selector: 'app-signature-field',
  templateUrl: './signature-field.component.html',
  styleUrls: ['./signature-field.component.css']
})
export class SignatureFieldComponent implements OnInit {
  @Input() fieldConfig!: FieldConfig;
  @Output() signatureChange = new EventEmitter<SignatureData>();
  
  selectedType: string = 'text';
  currentSignature: SignatureData | null = null;
  
  // Canvas/Signature Pad references
  @ViewChild('canvas') canvasRef!: ElementRef<HTMLCanvasElement>;
  @ViewChild('signaturePad') signaturePadRef!: ElementRef;
  
  private signaturePad?: SignaturePad;
  
  ngOnInit() {
    // Determinar tipo por defecto seg√∫n configuraci√≥n
    if (this.fieldConfig.type === 'signature-text') {
      this.selectedType = 'text';
    } else if (this.fieldConfig.type === 'signature-canvas') {
      this.selectedType = 'canvas';
    } else if (this.fieldConfig.type === 'signature-image') {
      this.selectedType = 'image';
    }
  }
  
  setType(type: string) {
    this.selectedType = type;
    this.clearSignature();
    
    if (type === 'signature-pad') {
      setTimeout(() => this.initSignaturePad(), 100);
    }
  }
  
  // M√©todo para texto
  onTextChange(value: string) {
    this.currentSignature = {
      type: 'text',
      value: value
    };
    this.signatureChange.emit(this.currentSignature);
  }
  
  // M√©todo para canvas
  saveCanvasSignature() {
    const canvas = this.canvasRef.nativeElement;
    const dataURL = canvas.toDataURL('image/png');
    
    this.currentSignature = {
      type: 'canvas',
      value: dataURL
    };
    this.signatureChange.emit(this.currentSignature);
  }
  
  // M√©todo para signature pad
  private initSignaturePad() {
    const canvas = this.signaturePadRef.nativeElement;
    this.signaturePad = new SignaturePad(canvas);
    
    this.signaturePad.addEventListener('endStroke', () => {
      this.saveSignaturePad();
    });
  }
  
  saveSignaturePad() {
    if (this.signaturePad && !this.signaturePad.isEmpty()) {
      const dataURL = this.signaturePad.toDataURL('image/png');
      
      this.currentSignature = {
        type: 'signature-pad',
        value: dataURL
      };
      this.signatureChange.emit(this.currentSignature);
    }
  }
  
  // M√©todo para imagen
  onImageSelected(event: Event) {
    const file = (event.target as HTMLInputElement).files?.[0];
    if (file && file.type === 'image/png') {
      const reader = new FileReader();
      reader.onload = (e) => {
        const dataURL = e.target?.result as string;
        
        this.currentSignature = {
          type: 'image',
          value: dataURL
        };
        this.signatureChange.emit(this.currentSignature);
      };
      reader.readAsDataURL(file);
    }
  }
  
  clearSignature() {
    this.currentSignature = null;
    this.signatureChange.emit(null);
    
    if (this.signaturePad) {
      this.signaturePad.clear();
    }
  }
}
Este componente maneja autom√°ticamente todos los formatos de firma y se integra perfectamente con tu backend FastAPI actualizado. Los datos se env√≠an en el formato esperado por tu API.