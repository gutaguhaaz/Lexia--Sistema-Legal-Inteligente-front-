
<section class="content">
  <div class="content-block">
    <div class="block-header">
      <h2>{{ 'MENU.GENERATE_CLAUSE' | translate }}</h2>
      <app-breadcrumb 
        [title]="'MENU.GENERATE_CLAUSE' | translate" 
        [items]="[('MENUITEMS.MAIN.TEXT' | translate), ('MENU.CONTRACTS' | translate)]" 
        [active_item]="'MENU.GENERATE_CLAUSE' | translate">
      </app-breadcrumb>
    </div>
    <div class="row clearfix">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
          <div class="header">
            <h2>Generador de Cláusulas Inteligente</h2>
            <small>Selecciona el tipo de cláusula y proporciona el contexto para generar cláusulas específicas</small>
          </div>
          <div class="body">
            <form [formGroup]="clauseForm" (ngSubmit)="onSubmit()">
              <!-- Clause Type Selection -->
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Tipo de Cláusula</mat-label>
                    <mat-select formControlName="clauseType" required>
                      <mat-option *ngFor="let type of clauseTypes" [value]="type.value">
                        {{ type.label }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="clauseForm.get('clauseType')?.hasError('required')">
                      El tipo de cláusula es requerido
                    </mat-error>
                  </mat-form-field>
                </div>
                
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Contexto Legal</mat-label>
                    <mat-select formControlName="legalContext" required>
                      <mat-option *ngFor="let context of legalContexts" [value]="context.value">
                        {{ context.label }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="clauseForm.get('legalContext')?.hasError('required')">
                      El contexto legal es requerido
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>

              <!-- Specific Requirements -->
              <div class="row">
                <div class="col-md-12">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Descripción Específica</mat-label>
                    <textarea matInput formControlName="specificRequirements" rows="4" 
                              placeholder="Describe los requisitos específicos para esta cláusula..." required></textarea>
                    <mat-error *ngIf="clauseForm.get('specificRequirements')?.hasError('required')">
                      La descripción específica es requerida
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>

              <!-- Additional Parameters -->
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Jurisdicción</mat-label>
                    <mat-select formControlName="jurisdiction">
                      <mat-option *ngFor="let jurisdiction of jurisdictions" [value]="jurisdiction.value">
                        {{ jurisdiction.label }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Nivel de Protección</mat-label>
                    <mat-select formControlName="protectionLevel">
                      <mat-option *ngFor="let level of protectionLevels" [value]="level.value">
                        {{ level.label }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>

              <!-- Submit Button -->
              <div class="row">
                <div class="col-md-12 text-center">
                  <button mat-raised-button color="primary" type="submit" 
                          [disabled]="clauseForm.invalid || isGenerating" class="btn-lg">
                    <mat-icon *ngIf="isGenerating">refresh</mat-icon>
                    <mat-icon *ngIf="!isGenerating">gavel</mat-icon>
                    {{ isGenerating ? 'Generando...' : 'Generar Cláusula' }}
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Generated Clauses Display -->
    <div class="row clearfix" *ngIf="generatedClauses.length > 0">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
          <div class="header">
            <h2>Cláusulas Generadas</h2>
            <small>{{ generatedClauses.length }} cláusula(s) generada(s)</small>
          </div>
          <div class="body">
            <div *ngFor="let clause of generatedClauses; let i = index" class="clause-item mb-4">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="clause-title">Opción {{ i + 1 }}</h5>
                <div class="clause-actions">
                  <button mat-icon-button (click)="copyClause(clause)" matTooltip="Copiar cláusula">
                    <mat-icon>content_copy</mat-icon>
                  </button>
                  <button mat-icon-button (click)="saveClause(clause)" matTooltip="Guardar cláusula">
                    <mat-icon>save</mat-icon>
                  </button>
                </div>
              </div>
              <div class="clause-content p-3 border rounded">
                <p>{{ clause.content }}</p>
              </div>
              <div class="clause-metadata mt-2">
                <mat-chip-listbox>
                  <mat-chip-option [selected]="true" color="primary">
                    {{ clause.type }}
                  </mat-chip-option>
                  <mat-chip-option [selected]="true" color="accent">
                    {{ clause.legalContext }}
                  </mat-chip-option>
                  <mat-chip-option [selected]="true" color="warn">
                    Riesgo: {{ clause.riskLevel }}
                  </mat-chip-option>
                </mat-chip-listbox>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
