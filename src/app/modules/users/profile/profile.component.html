<section class="content">
  <div class="content-block">
    <div class="block-header">
      <app-breadcrumb
        [title]="'PROFILE.TITLE' | translate"
        [items]="['MENUITEMS.MAIN.TEXT' | translate]"
        [active_item]="'PROFILE.TITLE' | translate"
      ></app-breadcrumb>
    </div>

    <div class="row clearfix">
      <div class="col-lg-12">
        <mat-card>
          <mat-card-header>
            <mat-card-title>{{ 'PROFILE.TITLE' | translate }}</mat-card-title>
            <mat-card-subtitle>{{ 'PROFILE.SUBTITLE' | translate }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <!-- Usuario Info -->
            <div class="user-info mb-4" *ngIf="user">
              <div class="row">
                <div class="col-md-3 text-center">
                  <div class="user-avatar">
                    <mat-icon class="large-avatar">account_circle</mat-icon>
                  </div>
                </div>
                <div class="col-md-9">
                  <h4>{{ user.full_name }}</h4>
                  <p class="text-muted mb-1">{{ user.email }}</p>
                  <p class="text-muted mb-1">{{ user.username }}</p>
                  <span class="badge badge-success" *ngIf="user.is_active">{{ 'PROFILE.ACTIVE' | translate }}</span>
                  <span class="badge badge-danger" *ngIf="!user.is_active">{{ 'PROFILE.INACTIVE' | translate }}</span>
                  <span class="badge badge-primary ms-2" *ngIf="user.is_admin">{{ 'PROFILE.ADMIN' | translate }}</span>
                </div>
              </div>
            </div>

            <!-- Mensaje -->
            <div *ngIf="message" [class]="'alert alert-' + (messageType === 'success' ? 'success' : 'danger')" role="alert">
              {{ message }}
            </div>

            <!-- Tabs -->
            <mat-tab-group>
              <!-- Tab Perfil -->
              <mat-tab [label]="'PROFILE.TAB_PROFILE' | translate">
                <div class="tab-content p-3">
                  <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
                    <div class="row">
                      <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.FULL_NAME' | translate }}</mat-label>
                          <input matInput formControlName="full_name">
                          <mat-icon matSuffix>person</mat-icon>
                          <mat-error *ngIf="profileForm.get('full_name')?.errors?.['required']">
                            {{ 'PROFILE.FULL_NAME_REQUIRED' | translate }}
                          </mat-error>
                        </mat-form-field>
                      </div>

                      <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.POSITION' | translate }}</mat-label>
                          <input matInput formControlName="position">
                          <mat-icon matSuffix>work</mat-icon>
                        </mat-form-field>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.PHONE' | translate }}</mat-label>
                          <input matInput formControlName="phone">
                          <mat-icon matSuffix>phone</mat-icon>
                        </mat-form-field>
                      </div>

                      <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.ORGANIZATION' | translate }}</mat-label>
                          <input matInput formControlName="organization">
                          <mat-icon matSuffix>business</mat-icon>
                        </mat-form-field>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.LANGUAGE' | translate }}</mat-label>
                          <mat-select formControlName="language">
                            <mat-option *ngFor="let lang of languages" [value]="lang.value">
                              {{ lang.label }}
                            </mat-option>
                          </mat-select>
                          <mat-icon matSuffix>language</mat-icon>
                        </mat-form-field>
                      </div>
                    </div>

                    <div class="form-actions">
                      <button mat-raised-button color="primary" type="submit" [disabled]="loading || profileForm.invalid">
                        <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                        {{ 'PROFILE.UPDATE_PROFILE' | translate }}
                      </button>
                    </div>
                  </form>
                </div>
              </mat-tab>

              <!-- Tab Cambiar ContraseÃ±a -->
              <mat-tab [label]="'PROFILE.TAB_PASSWORD' | translate">
                <div class="tab-content p-3">
                  <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
                    <div class="row">
                      <div class="col-md-12">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.CURRENT_PASSWORD' | translate }}</mat-label>
                          <input matInput [type]="hideCurrentPassword ? 'password' : 'text'" formControlName="current_password">
                          <button mat-icon-button matSuffix (click)="hideCurrentPassword = !hideCurrentPassword" type="button">
                            <mat-icon>{{hideCurrentPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                          </button>
                          <mat-error *ngIf="passwordForm.get('current_password')?.errors?.['required']">
                            {{ 'PROFILE.CURRENT_PASSWORD_REQUIRED' | translate }}
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.NEW_PASSWORD' | translate }}</mat-label>
                          <input matInput [type]="hideNewPassword ? 'password' : 'text'" formControlName="new_password">
                          <button mat-icon-button matSuffix (click)="hideNewPassword = !hideNewPassword" type="button">
                            <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                          </button>
                          <mat-error *ngIf="passwordForm.get('new_password')?.errors?.['required']">
                            {{ 'PROFILE.NEW_PASSWORD_REQUIRED' | translate }}
                          </mat-error>
                          <mat-error *ngIf="passwordForm.get('new_password')?.errors?.['invalidPassword']">
                            {{ 'PROFILE.PASSWORD_INVALID' | translate }}
                          </mat-error>
                        </mat-form-field>
                      </div>

                      <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>{{ 'PROFILE.CONFIRM_PASSWORD' | translate }}</mat-label>
                          <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirm_password">
                          <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" type="button">
                            <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                          </button>
                          <mat-error *ngIf="passwordForm.get('confirm_password')?.errors?.['required']">
                            {{ 'PROFILE.CONFIRM_PASSWORD_REQUIRED' | translate }}
                          </mat-error>
                          <mat-error *ngIf="passwordForm.get('confirm_password')?.errors?.['passwordMismatch']">
                            {{ 'PROFILE.PASSWORD_MISMATCH' | translate }}
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>

                    <div class="password-requirements">
                      <small class="text-muted">{{ 'PROFILE.PASSWORD_REQUIREMENTS' | translate }}</small>
                    </div>

                    <div class="form-actions">
                      <button mat-raised-button color="primary" type="submit" [disabled]="loading || passwordForm.invalid">
                        <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                        {{ 'PROFILE.CHANGE_PASSWORD' | translate }}
                      </button>
                    </div>
                  </form>
                </div>
              </mat-tab>
            </mat-tab-group>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</section>